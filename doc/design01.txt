Code write use the Rust lang.
下面是一份給「AI 產生程式」看的規格文字，描述你要做的行列 30（Array30）字詞輸入法，包含詞組規則與介面行為，全部以繁體中文撰寫，方便直接丟給模型當需求說明用。
​

系統總體說明
本專案要實作一套 行列 30 輸入法（Array30） 的獨立應用程式，支援：

Windows：GUI 介面，可將「輸出區」內容複製到剪貼簿。

Linux：文字模式（console）介面，在終端機中互動輸入。

輸入法邏輯遵循行列 30 的字根、單字取碼與「詞彙輸入」規則，詞彙取碼方式與官方釋出的詞庫與教學相容。
​

輸入法核心規則
1. 鍵盤與字根基礎
使用行列 30 鍵位配置：以標準英文鍵盤上 30 個英文字母鍵作為「行列鍵」，對應字根與特別碼。

每個漢字由 1～4 個字根組成，依照「前三後一」原則取碼：

依書寫順序取前三個字根與最後一個字根，最多四碼。

如果不足四個字根，則全部取碼，不補碼。
​

2. 單字取碼規則（簡述）
單字編碼遵守行列教室所述三大原則：

取前面三個字根與最後一個字根。

優先選擇筆畫最多、最完整的字根。

遵守筆順，避免為了湊簡碼而亂拆字。
​

資料來源可使用官方整理好的字根表與碼表（如 array30 GitHub 專案）作為字碼定義，不在此重複列出。
​

3. 詞彙輸入（Word / Phrase）規則
本輸入法必須實作「詞彙輸入」功能，規則參考行列官方說明與釋出的詞庫設計。
​

詞彙鍵：

使用半形單引號 ' 作為「詞彙終結鍵」或「詞鍵」。

使用者先輸入詞彙的四碼，再按 '，系統以詞庫查找對應詞彙並於候選列顯示。
​

兩字詞取碼：

取第一個字的首、尾字根碼。

再取第二個字的首、尾字根碼。

共四碼，然後接 '。

例如官方示例「台灣」即採此規則取碼後再按 ' 上詞。
​

三字詞取碼（建議規則）：

依行列官方詞庫原則，常用做法是：

取第一字首碼。

取第二字首碼。

取第三字首、尾兩碼。

詳細可比照官方詞庫說明與行列教室文字說明，保持與既有詞庫一致。
​

多字詞（四字以上）：

採「首尾＋中間關鍵字」的四碼設計，原則同官方詞庫：

優先取詞頭與詞尾的首碼。

其餘碼從中間關鍵字選擇，以保持辨識度。

具體拆碼可直接引用行列官方詞庫（array30 專案裡的詞庫檔）既有編碼，不需重新設計規則。
​

詞彙查找行為：

使用者輸入完四碼後按 '：

若詞庫中有唯一匹配詞，直接上詞到編輯區或輸出區（依設計）。

若有多個匹配詞，顯示候選列表供選擇。

若無任何對應詞，則系統可：

退回至單字輸入狀態；或顯示「無此詞」提示，由需求端決定。

連續輸入支援（選配）：

可選擇支援「詞句連書」：

使用者連續輸入多個字碼或詞碼，系統根據詞庫與字序自動斷詞上字。

每個字之間允許使用斷字符（如 \ 或 '）輔助分隔，類似 RIME 行列方案的做法。
​

應用程式介面規格
1. 共通概念（Win GUI / Linux Console 同構）
整個輸入流程由四個主要區塊概念構成：

鍵盤輸入區（原始鍵序區）

顯示使用者目前輸入的「英文鍵序列」，尚未轉換為行列碼與漢字。

例如輸入 abce'，畫面上先顯示字串 abce'，供除錯與提示。

編輯區（組字／組詞區）

顯示目前尚未確定上屏的候選漢字或詞彙。

行為：

使用者按下行列鍵，系統根據碼表即時顯示候選字。

支援多重候選（同碼字）與翻頁。

支援候選詞（按 ' 後，列出詞彙候選）。

輸出區（固定文字區）

顯示「已經確定輸出」的漢字、詞彙或其他符號。

編輯區內容在使用者按下空白鍵、Enter 或數字選字之後，從編輯區移轉到輸出區。

輸出區內容在 Windows GUI 模式可一鍵複製到剪貼簿。

提示區（Hint / 說明區）

顯示與目前狀態相關的提示資訊，例如：

某個候選字／詞所對應的行列鍵碼。

提醒使用者：按 ' 可以進入詞彙輸入。

提示當前候選的選字鍵（數字鍵或其他快捷鍵）。

也可以顯示：目前正在輸入的碼為哪幾個字根、當前候選是第幾重碼等。
​

2. Windows GUI 版本細節
視窗區塊設計：

輸入列上方或側邊展示四個區塊：

鍵盤輸入區：顯示原始鍵序。

編輯區：顯示當前組字串與候選列表。

輸出區：顯示已輸出的固定文字，可用滑鼠選取。

提示區：顯示碼表提示與操作說明。

剪貼簿功能：

視窗提供「複製輸出」按鈕。

按下後，將輸出區全部文字複製到系統剪貼簿，方便貼到其他程式。

鍵盤操作行為：

行列鍵（A–Z）：作為字根輸入。

空白鍵：

若編輯區有候選字或詞，空白鍵用來上第一候選。

Enter：

可以與空白鍵同樣作為確認鍵，將編輯區內容上到輸出區。

數字鍵（1–9…）：對應候選列表的編號，選定某個候選上屏。

'：

在輸入四碼之後，作為「詞彙終結鍵」，啟動詞彙查找與候選顯示。

Esc / Backspace 等：

支援取消本次組字或刪除最後一碼，由實作端具體定義。

3. Linux 文字模式版本細節
畫面輸出形式：

以純文字行顯示四區資訊，例如：

第一行：鍵盤輸入：abce'

第二行：編輯區：候選[1]台 [2]抬 [3]颱 ...

第三行：輸出區：台灣是...

第四行：提示：按 ' 進入詞彙輸入；空白鍵上第一候選；數字鍵選字。

鍵盤操作行為與 GUI 版本相同，只是回饋透過終端機文字顯示。

若終端機不支援複製剪貼簿，由使用者自行用終端機或環境工具複製輸出區文字即可，程式本身不強制整合剪貼簿 API。

狀態機與流程（簡化描述）
空閒狀態（Idle）

鍵盤輸入區為空，編輯區為空，輸出區有既有文字。

輸入碼狀態（Typing Code）

使用者按下行列鍵，鍵盤輸入區累積原始鍵序。

系統依碼表查找單字候選，更新編輯區。

詞彙輸入狀態（Typing Phrase）

當鍵盤輸入區已累積 1～4 碼，且使用者按 '：

系統將這 4 碼視為詞碼，到詞庫查找對應詞彙。

若有結果，在編輯區顯示詞彙候選列表。

選字／選詞狀態（Choosing Candidate）

使用數字鍵或空白鍵確定某個候選字／詞。

所選結果加入輸出區，編輯區與鍵盤輸入區清空。

結束或持續輸入

使用者可重複輸入下一個字或詞。

在 Windows 版可隨時按下「複製輸出」按鈕，把目前輸出區的內容複製。
